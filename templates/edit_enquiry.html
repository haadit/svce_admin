<!DOCTYPE html>
<html>
  <head>
    <title>Edit Enquiry</title>
    <style>
      body {
        font-family: "Roboto", sans-serif;
        line-height: 1.6;
        margin: 0;
        background: linear-gradient(120deg, #f8fafc 0%, #e0e7ff 100%);
        color: #333;
        min-height: 100vh;
      }
      .container {
        max-width: 900px;
        margin: 40px auto;
        background: #fff;
        padding: 38px 38px 30px 38px;
        border-radius: 18px;
        box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        border-top: 4px solid #388bff;
        position: relative;
      }
      h2 {
        text-align: center;
        color: #2d3a4a;
        margin-bottom: 32px;
        font-size: 2.1rem;
        letter-spacing: 1px;
      }
      .form-group {
        margin-bottom: 22px;
      }
      label {
        display: block;
        margin-bottom: 8px;
        font-weight: 500;
        color: #3b4a5a;
        font-size: 1.08em;
      }
      input[type="text"],
      input[type="email"],
      input[type="number"],
      input[type="date"],
      textarea {
        width: 100%;
        padding: 12px;
        border: 2px solid #c7d2fe;
        border-radius: 6px;
        box-sizing: border-box;
        font-size: 1.05em;
        background: #f8fafc;
        transition: border 0.2s;
      }
      input[type="text"]:focus,
      input[type="email"]:focus,
      input[type="number"]:focus,
      input[type="date"]:focus,
      textarea:focus {
        border: 1.8px solid #007bff;
        outline: none;
        background: #fff;
      }
      .styled-select {
        width: 100%;
        padding: 12px;
        border: 2px solid #c7d2fe;
        border-radius: 6px;
        box-sizing: border-box;
        font-size: 1.05em;
        background: #f8fafc;
        transition: border 0.2s;
        appearance: none; /* Remove default browser styling */
        -webkit-appearance: none; /* Remove default browser styling for Webkit browsers */
        -moz-appearance: none; /* Remove default browser styling for Firefox */
        background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23007bff%22%20d%3D%22M287%2C114.1L145.2%2C26.4c-6.6-6.6-17-6.6-23.6%2C0L6.4%2C114.1c-6.6%2C6.6-6.6%2C17%2C0%2C23.6l23.6%2C23.6c6.7%2C6.7%2C17.2%2C6.7%2C23.9%2C0l96.2-96.2l96.2%2C96.2c6.7%2C6.7%2C17.2%2C6.7%2C23.9%2C0l23.6-23.6C293.6%2C131.1%2C293.6%2C120.7%2C287%2C114.1z%22%2F%3E%3C%2Fsvg%3E'); /* Add a custom arrow icon */
        background-repeat: no-repeat;
        background-position: right 12px top 50%;
        background-size: 12px auto;
        display: block;
        height: auto;
      }
      .styled-select:focus {
        border: 2px solid #007bff;
        outline: none;
        background: #fff;
      }
      textarea {
        resize: vertical;
        min-height: 100px;
      }
      .row {
        display: flex;
        flex-wrap: wrap;
        gap: 20px;
      }
      .row > .form-group {
        flex: 1 1 calc(50% - 10px);
      }
      .row.three-cols > .form-group {
        flex: 1 1 calc(33.333% - 13.333px);
      }
      .row.four-cols > .form-group {
        flex: 1 1 calc(25% - 15px);
      }
      .full-width {
        flex: 1 1 100%;
      }
      .section-title {
        margin-top: 36px;
        margin-bottom: 18px;
        font-size: 1.25rem;
        color: #007bff;
        border-bottom: 2px solid #e0e7ff;
        padding-bottom: 6px;
        font-weight: 600;
        letter-spacing: 0.5px;
      }
      .checkbox-group label {
        font-weight: normal;
        margin-bottom: 5px;
        display: flex;
        align-items: center;
        cursor: pointer;
      }
      .checkbox-group input[type="checkbox"] {
        margin-right: 10px;
        width: auto;
      }
      .button-group {
        margin-top: 6px !important;
        text-align: right !important;
      }
      button, 
      .print-btn {
        background-color: #007bff;
        color: white;
        padding: 13px 26px;
        border: none;
        border-radius: 6px;
        cursor: pointer;
        font-size: 1.08em;
        font-weight: 500;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.07);
        transition: background 0.2s;
      }
      button:hover, 
      .print-btn:hover {
        background-color: #0056b3;
      }
      .back-link {
        display: inline-block;
        margin-bottom: 20px;
        color: #555;
        text-decoration: none;
        font-weight: bold;
      }
      .back-link:hover {
        text-decoration: underline;
      }
      .error-message {
        color: #dc3545;
        background-color: #f8d7da;
        border: 1px solid #f5c6cb;
        border-radius: 5px;
        padding: 10px;
        margin-bottom: 20px;
      }
      .preference-list {
        margin-top: 15px;
        border: 1px solid #c7d2fe;
        padding: 10px;
        border-radius: 6px;
        background-color: #f8fafc;
      }
      .preference-list p {
        margin: 5px 0;
        padding-left: 10px;
        border-left: 3px solid #007bff;
      }
      .info-box {
        background-color: #e9f5ff;
        border: 1px solid #b3e0ff;
        color: #004085;
        border-radius: 5px;
        padding: 10px;
        margin-bottom: 20px;
        display: flex;
        align-items: center;
      }
      .info-box i {
        margin-right: 10px;
        font-size: 1.2rem;
      }
      .selected-course-row {
        background: #e6f2ff !important;
      }
      /* Status Colors */
      .status-waiting {
          color: #2563eb;
          background-color: #e0e7ff;
          padding: 4px 10px;
          border-radius: 6px;
          font-weight: 600;
      }
      .status-counseling-done {
          color: #059669;
          background-color: #d1fae5;
          padding: 4px 10px;
          border-radius: 6px;
          font-weight: 600;
      }
      .status-booking-done {
          color: #ea580c;
          background-color: #ffedd5;
          padding: 4px 10px;
          border-radius: 6px;
          font-weight: 600;
      }
      .status-follow-up {
          color: #dc2626;
          background-color: #fee2e2;
          padding: 4px 10px;
          border-radius: 6px;
          font-weight: 600;
      }
      /* Hide elements on screen, show only in print */
      .created-at-print {
          display: block; /* Visible by default */
          font-size: 1.1rem;
          font-weight: 500;
          color: #222;
          /* margin-bottom: 10px; /* Adjust if needed after positioning */
          position: absolute;
          top: 10px; /* Position from the top edge */
          right: 38px; /* Position from the right edge, aligned with container padding */
          z-index: 10; /* Ensure it's above other content */
          padding: 5px 10px; /* Add some padding around the text */
          border-radius: 6px; /* Match other rounded corners */
          background-color: #e9f5ff; /* Light blue background */
          border: 1px solid #b3e0ff; /* Light blue border */
      }
      .created-at-print span {
          background: #f4f6fa; 
          padding: 4px 10px; 
          border-radius: 6px; 
          font-weight: 600;
      }
      /* General print adjustments */
      @media print {
          @page {
              margin: 0.5cm; /* Adjust margins for printing */
          }
          /* Hide non-essential elements for print */
          .button-group,
          .print-btn,
          .back-link,
          .mandatory-note,
          .info-box,
          .print-hidden {
              display: none !important;
          }
          /* Show created_at timestamp */
          .created-at-print {
              display: flex !important;
              visibility: visible !important;
              justify-content: flex-end !important; /* Align to the right */
              width: 100% !important;
              margin-top: 0 !important;
              margin-bottom: 10px !important;
              position: static !important; /* Remove absolute positioning for print */
              text-align: right !important; /* Ensure right alignment in print flow */
              z-index: 9999 !important; /* Ensure it stacks on top */
              box-sizing: border-box !important;
          }
          /* Ensure logo fills width and other print styles are correct */
          img[alt="College Logo"] {
              max-width: 220px !important; /* Further reduce the max width for print */
              width: 220px !important; /* Further reduce the width for print */
              margin-bottom: 4px !important; /* Add space below logo */
              padding: 0 !important; /* Remove padding around logo */
              box-shadow: none !important; /* Remove shadow for print */
              border-radius: 0 !important; /* Remove border radius for print */
              background: none !important; /* Remove background for print */
          }
          body {
            background: #fff !important;
            font-size: 10.0px !important; /* Adjusted base font size for readability */
            margin: 0 !important;
            padding: 0 !important;
          }
          .container {
            box-shadow: none !important;
            border: none !important;
            margin: 0 !important; /* Ensure no margin on container */
            padding: 4px !important; /* Adjusted container padding */
            max-width: 100vw !important;
            width: auto !important;
          }
          .row, .row.three-cols, .row.four-cols, .row.two-cols {
              gap: 2.5px !important; /* Adjusted gap */
              margin-bottom: 2.5px !important; /* Adjusted margin */
          }
          .styled-select {
            width: 100%;
            padding: 3px !important; /* Adjusted padding for select */
            border: 1.5px solid #c7d2fe;
            border-radius: 6px;
            box-sizing: border-box;
            font-size: 1.0em !important; /* Adjusted font size for select */
            background: #f8fafc;
            transition: border 0.2s;
            appearance: none; /* Remove default browser styling */
            -webkit-appearance: none; /* Remove default browser styling for Webkit browsers */
            -moz-appearance: none; /* Remove default browser styling for Firefox */
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%23007bff%22%20d%3D%22M287%2C114.1L145.2%2C26.4c-6.6-6.6-17-6.6-23.6%2C0L6.4%2C114.1c-6.6%2C6.6-6.6%2C17%2C0%2C23.6l23.6%2C23.6c6.7%2C6.7%2C17.2%2C6.7%2C23.9%2C0l96.2-96.2l96.2%2C96.2c6.7%2C6.7%2C17.2%2C6.7%2C23.9%2C0l23.6-23.6C293.6%2C131.1%2C293.6%2C120.7%2C287%2C114.1z%22%2F%3E%3C%2Fsvg%3E'); /* Add a custom arrow icon */
            background-repeat: no-repeat;
            background-position: right 12px top 50%;
            background-size: 12px auto;
            display: block; /* Ensure it takes the full width in the grid */
            height: auto; /* Adjust height automatically based on content and padding */
          }
          .form-group {
              margin-bottom: 4px !important; /* Adjusted margin for form groups */
          }
          .section-title {
              font-size: 0.9em !important; /* Reduced section title size */
              margin-top: 5px !important; /* Reduced margin */
              margin-bottom: 2.5px !important; /* Reduced margin */
              padding-bottom: 0px !important;
          }
          input, textarea, select {
              font-size: 0.9em !important; /* Adjusted text size in fields */
              padding: 3px 5px !important; /* Adjusted padding */
          }
          label {
              font-size: 0.9em !important; /* Adjusted label size */
              margin-bottom: 1px !important; /* Adjusted margin */
          }
          h2, .header-title { /* Adjust main title for print */
              font-size: 1.05em !important; /* Reduced main title size */
              margin: 0 0 3px 0 !important; /* Reduced margin */
              text-align: center;
          }
          .preference-list, .checkbox-group {
              padding: 4px !important; /* Adjusted padding */
              margin-bottom: 6px !important; /* Adjusted margin */
              min-height: 0 !important;
              box-sizing: border-box !important;
          }
          textarea {
              min-height: 22px !important; /* Adjusted min height */
          }
          .checkbox-group {
             display: block !important;
             border: 1px solid #c7d2fe !important;
             background: #f8fafc !important;
             border-radius: 6px !important;
             padding: 3px !important; /* Adjusted padding */
             margin-top: 4px !important; /* Adjusted margin */
             margin-bottom: 4px !important; /* Adjusted margin */
          }
          .checkbox-group > div {
            margin-bottom: 1.5px !important; /* Adjusted margin */
            padding: 0 !important;
            border-radius: 4px !important;
            border: none !important;
            background: none !important;
          }
          .checkbox-group > div:last-child {
            margin-bottom: 0 !important; /* Ensure no margin on last item */
          }
          .error-message {
            margin-bottom: 4px !important; /* Adjusted margin */
            padding: 4px !important; /* Adjusted padding */
          }
          .checkbox-group input[type="number"] { display: none !important; }
          .checkbox-group input[type="checkbox"] { display: none !important; }
          .checkbox-group span[style*="border-radius: 50%"] {
            margin-right: 3px !important; /* Adjusted margin */
            width: 14px !important; /* Reduced size */
            height: 14px !important; /* Reduced size */
            font-size: 0.9em !important; /* Reduced font size */
          }
          .checkbox-group label {
            font-size: 0.9em !important; /* Adjusted font size */
            margin-bottom: 0 !important; /* Ensure no margin */
            color: #333; /* Ensure label color is readable */
          }
          .checkbox-group > div {
             grid-template-columns: auto 1fr !important; /* Maintain grid structure */
             gap: 2.5px !important; /* Adjusted gap */
             align-items: center !important;
             margin-bottom: 1.5px !important; /* Adjusted margin */
          }
          .checkbox-group {
             border: none !important;
             background: none !important;
             padding: 0 !important;
             margin-top: 3px !important; /* Adjusted margin */
             margin-bottom: 3px !important; /* Adjusted margin */
          }
          /* Ensure elements hidden on screen are still hidden in print unless explicitly shown */
          .hide-on-print:not(.created-at-print) {
              display: none !important;
          }
          /* Adjust created_at for print */
          .created-at-print {
              font-size: 0.9em !important; /* Adjusted font size */
              padding: 0 !important; /* Remove padding */
              border: none !important; /* Remove border */
              background-color: transparent !important; /* Remove background */
          }
          .created-at-print span {
              padding: 0 !important;
              border-radius: 0 !important; /* Remove span border-radius */
              background: none !important; /* Remove span background */
              font-weight: normal !important; /* Adjust font weight */
          }
          /* Ensure details section is visible and laid out correctly in print */
          .details-section {
              display: flex !important;
              visibility: visible !important;
              width: 100% !important;
              justify-content: space-between !important;
              align-items: center !important;
              margin-bottom: 4px !important; /* Adjusted margin */
              margin-top: 4px !important; /* Adjusted margin */
              z-index: 9999 !important; /* Ensure it stacks on top */
              font-size: 0.9em !important; /* Adjusted font size for labels */
          }
          .details-section span, /* Target the value spans */
          .details-section input[type="date"] /* Target the date input */ {
              font-size: 0.9em !important; /* Adjusted font size for values */
              padding: 1px 3px !important; /* Adjusted padding */
              background: none !important; /* Remove background for print */
          }
      }
    </style>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css"
    />
  </head>
  <body>
    <div class="container">
      <div class="header-section" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 10px; gap: 18px;">
        <img src="{{ url_for('static', filename='college_logo.png') }}" alt="College Logo" style="max-width: 380px; background: #fff; border-radius: 12px; box-shadow: 0 2px 12px rgba(0,0,0,0.08); padding: 8px;" />
        <div style="display: flex; gap: 12px; align-items: center;">
          <a href="{{ url_for('dashboard') }}" class="back-link" style="margin-bottom: 0; background: #e3edff; color: #1a237e; padding: 10px 22px; border-radius: 8px; font-weight: 600; text-decoration: none; font-size: 1.08em; box-shadow: 0 2px 8px rgba(0,0,0,0.04); transition: background 0.2s;">&larr; Back to Dashboard</a>
          <button type="button" onclick="window.print()" class="print-btn" style="font-size: 1.1em; font-weight: 600; padding: 12px 32px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); background: #388bff;"> <i class="fa fa-print"></i> Print</button>
        </div>
      </div>
      <div class="details-section" style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 18px; margin-top: 8px;">
        <div style="font-size: 0.9rem; font-weight: 500; color: #222;">Token No.: <span style="background: #f4f6fa; padding: 4px 10px; border-radius: 6px; font-weight: 600;">{{ enquiry.token_number | default('', true) }}</span></div>
        <!-- <div style="font-size: 0.9rem; font-weight: 500; color: #222; display: flex; align-items: center; gap: 8px;">Status: 
            <span
                class="{% if enquiry.status == 'Waiting for counseling' %}status-waiting{% elif enquiry.status == 'Counciling done.' %}status-counseling-done{% elif enquiry.status == 'booking done.' %}status-booking-done{% elif enquiry.status == 'need to follow up.' %}status-follow-up{% endif %}"
            >
                {{ enquiry.status | default('N/A', true) }}
            </span>
        </div> -->
        <div style="font-size: 0.8rem; font-weight: 500; color: #222; display: flex; align-items: center; gap: 8px;">
          <label for="enquiry_date" style="margin: 0; font-weight: 500;">Date:</label>
          <input
            type="date"
            id="enquiry_date"
            name="enquiry_date"
            value="{{ enquiry.enquiry_date | default('', true) }}"
            style="background: #f4f6fa; padding: 4px 10px; border-radius: 6px; font-weight: 600; border: 1px solid #c7d2fe; font-size: 1.08em; color: #222;"
          />
        </div>
      </div>

      {% if not connected %}
      <p class="error-message">Failed to load enquiry details.</p>
      {% if error %}
      <p class="error-message">Error: {{ error }}</p>
      {% endif %} {% elif enquiry is none %}
      <p class="error-message">Enquiry not found.</p>
      {% else %} {% if error %}
      <p class="error-message">Error: {{ error }}</p>
      {% endif %}

      <div class="created-at-print">
          Created At: <span>{{ enquiry.created_at | default('N/A', true) }}</span>
      </div>

      <form method="POST">
        <div class="row">
          <div class="form-group">
            <label for="student_name">Student Name:</label>
            <input
              type="text"
              id="student_name"
              name="student_name"
              value="{{ enquiry.student_name | default('', true) }}"
            />
          </div>
          <div class="form-group">
            <label for="father_name">Father's Name:</label>
            <input
              type="text"
              id="father_name"
              name="father_name"
              value="{{ enquiry.father_name | default('', true) }}"
            />
          </div>
        </div>
        <div class="row">
          <div class="form-group">
            <label for="mother_name">Mother's Name:</label>
            <input
              type="text"
              id="mother_name"
              name="mother_name"
              value="{{ enquiry.mother_name | default('', true) }}"
            />
          </div>
          <div class="form-group full-width">
            <label for="address">Address:</label>
            <textarea id="address" name="address">
{{ enquiry.address | default('', true) }}</textarea
            >
          </div>
        </div>

        <div class="section-title">Contact Details</div>
        <div class="row">
          <div class="form-group">
            <label for="student_email">Student Email:</label>
            <input
              type="email"
              id="student_email"
              name="student_email"
              value="{{ enquiry.student_email | default('', true) }}"
            />
          </div>
          <div class="form-group">
            <label for="student_mobile">Student Mobile:</label>
            <input
              type="text"
              id="student_mobile"
              name="student_mobile"
              value="{{ enquiry.student_mobile | default('', true) }}"
            />
          </div>
          <div class="form-group">
            <label for="education_qualification">Education Qualification:</label>
            <select id="education_qualification" name="education_qualification" class="styled-select">
              <option value="">Select Qualification</option>
              {% for option in education_qualification_options %}
              <option value="{{ option }}" {% if enquiry.educational_qualification == option %}selected{% endif %}>
                {% if option == "12th" %}12th Standard{% else %}{{ option }}{% endif %}
              </option>
              {% endfor %}
            </select>
          </div>
        </div>
        <div class="row">
          <div class="form-group">
            <label for="father_mobile">Father's Mobile Number:</label>
            <input
              type="text"
              id="father_mobile"
              name="father_mobile"
              value="{{ enquiry.father_mobile | default('', true) }}"
            />
          </div>
          <div class="form-group">
            <label for="mother_mobile">Mother's Mobile Number:</label>
            <input
              type="text"
              id="mother_mobile"
              name="mother_mobile"
              value="{{ enquiry.mother_mobile | default('', true) }}"
            />
          </div>
        </div>
        <div class="row full-width">
          <div class="form-group">
            <label for="reference">Reference:</label>
            <input
              type="text"
              id="reference"
              name="reference"
              value="{{ enquiry.reference | default('', true) }}"
            />
          </div>
        </div>
        <div class="row">
          <div class="form-group">
            <label for="education_board">Education Board (12th):</label>
            <select id="education_board" name="education_board" onchange="toggle11thFields()" class="styled-select">
              <option value="">Select Board</option>
              {% set current_board = enquiry.education_board|default('', true) %}
              {% if current_board and current_board not in education_board_options %}
                <option value="{{ current_board }}" selected>{{ current_board }}</option>
              {% endif %}
              {% for board in education_board_options %}
                <option value="{{ board }}" {% if current_board == board %}selected{% endif %}>{{ board }}</option>
              {% endfor %}
            </select>
          </div>
        </div>
        <div id="section12thStandard">
          <div class="section-title">12th Standard: (Physics, Chemistry, and Mathematics are mandatory)</div>
          <div class="row three-cols" id="row12thPCM">
            <div class="form-group">
              <label for="physics_marks">Physics:</label>
              <input type="number" id="physics_marks" name="physics_marks" value="{{ enquiry.physics_marks | default('', true) }}" step="any">
            </div>
            <div class="form-group">
              <label for="chemistry_marks">Chemistry:</label>
              <input type="number" id="chemistry_marks" name="chemistry_marks" value="{{ enquiry.chemistry_marks | default('', true) }}" step="any">
            </div>
            <div class="form-group">
              <label for="mathematics_marks">Mathematics:</label>
              <input type="number" id="mathematics_marks" name="mathematics_marks" value="{{ enquiry.mathematics_marks | default('', true) }}" step="any">
            </div>
          </div>
          
          <div id="section11th">
            <div class="section-title">11th Standard Details <span style="color: red; font-size: 0.8em;">(For AP/Telangana students only)</span></div>
            <div class="row three-cols">
              <div class="form-group">
                <label for="physics_marks_11">Physics (Theory) (11th):</label>
                <input type="number" id="physics_marks_11" name="physics_marks_11" value="{{ enquiry.physics_marks_11 | default('', true) }}" step="any">
              </div>
              <div class="form-group">
                <label for="chemistry_marks_11">Chemistry (Theory) (11th):</label>
                <input type="number" id="chemistry_marks_11" name="chemistry_marks_11" value="{{ enquiry.chemistry_marks_11 | default('', true) }}" step="any">
              </div>
              <div class="form-group">
                <label for="mathematics_marks_11a">Mathematics (A) (11th):</label>
                <input type="number" id="mathematics_marks_11a" name="mathematics_marks_11a" value="{{ enquiry.mathematics_marks_11a | default('', true) }}" step="any">
              </div>
            </div>
            <div class="row three-cols">
              <div class="form-group">
                <label for="mathematics_marks_11b">Mathematics (B) (11th):</label>
                <input type="number" id="mathematics_marks_11b" name="mathematics_marks_11b" value="{{ enquiry.mathematics_marks_11b | default('', true) }}" step="any">
              </div>
              <div class="form-group">
                <label for="english_marks_11">English (11th):</label>
                <input type="number" id="english_marks_11" name="english_marks_11" value="{{ enquiry.english_marks_11 | default('', true) }}" step="any">
              </div>
              <div class="form-group">
                <label for="language_marks_11">Language (11th):</label>
                <input type="number" id="language_marks_11" name="language_marks_11" value="{{ enquiry.language_marks_11 | default('', true) }}" step="any">
              </div>
            </div>
             <div class="section-title">12th Standard Details <span style="color: red; font-size: 0.8em;">(For AP/Telangana students only)</span></div>
             <div class="row three-cols">
               <div class="form-group">
                 <label for="physics_marks_12">Physics (Theory) (12th):</label>
                 <input type="number" id="physics_marks_12" name="physics_marks_12" value="{{ enquiry.physics_marks | default('', true) }}" step="any">
               </div>
               <div class="form-group">
                 <label for="physics_marks_12_practical">Physics (Practical) (12th):</label>
                 <input type="number" id="physics_marks_12_practical" name="physics_marks_12_practical" value="{{ enquiry.physics_marks_12_practical | default('', true) }}" step="any">
               </div>
               <div class="form-group">
                 <label for="chemistry_marks_12">Chemistry (Theory) (12th):</label>
                 <input type="number" id="chemistry_marks_12" name="chemistry_marks_12" value="{{ enquiry.chemistry_marks | default('', true) }}" step="any">
               </div>
             </div>
             <div class="row three-cols">
               <div class="form-group">
                 <label for="chemistry_marks_12_practical">Chemistry (Practical) (12th):</label>
                 <input type="number" id="chemistry_marks_12_practical" name="chemistry_marks_12_practical" value="{{ enquiry.chemistry_marks_12_practical | default('', true) }}" step="any">
               </div>
               <div class="form-group">
                 <label for="mathematics_marks_12a">Mathematics (A) (12th):</label>
                 <input type="number" id="mathematics_marks_12a" name="mathematics_marks_12a" value="{{ enquiry.mathematics_marks_12a | default('', true) }}" step="any">
               </div>
               <div class="form-group">
                 <label for="mathematics_marks_12b">Mathematics (B) (12th):</label>
                 <input type="number" id="mathematics_marks_12b" name="mathematics_marks_12b" value="{{ enquiry.mathematics_marks_12b | default('', true) }}" step="any">
               </div>
             </div>
           </div>
           <script>
             function toggle11thFields() {
               var board = document.getElementById('education_board').value;
               var section11th = document.getElementById('section11th');
               var section12thStandard = document.getElementById('section12thStandard');
               if (board === 'AP/Telangana') {
                 section11th.style.display = 'block';
                 section12thStandard.style.display = 'none';
               } else {
                 section11th.style.display = 'none';
                 section12thStandard.style.display = 'flex';
               }
             }
             document.addEventListener('DOMContentLoaded', function() {
               toggle11thFields();
             });
           </script>
         </div>
         <script>
           function toggle11thFields() {
             var board = document.getElementById('education_board').value;
             var section11th = document.getElementById('section11th');
             var section12thStandard = document.getElementById('section12thStandard');
             if (board === 'AP/Telangana') {
               section11th.style.display = 'block';
               section12thStandard.style.display = 'none';
             } else {
               section11th.style.display = 'none';
               section12thStandard.style.display = 'flex';
             }
           }
           document.addEventListener('DOMContentLoaded', function() {
             toggle11thFields();
           });
         </script>

        <div id="optionalSubjectsSection">
          <div class="section-title">CS, BIO, ECE (Optional)</div>
          <div class="row three-cols">
            <div class="form-group">
              <label for="cs_marks">CS: (Optional)</label>
              <input
                type="number"
                id="cs_marks"
                name="cs_marks"
                value="{{ enquiry.cs_marks | default('', true) }}"
                step="any"
              />
            </div>
            <div class="form-group">
              <label for="bio_marks">BIO: (Optional)</label>
              <input
                type="number"
                id="bio_marks"
                name="bio_marks"
                value="{{ enquiry.bio_marks | default('', true) }}"
                step="any"
              />
            </div>
            <div class="form-group">
              <label for="ece_marks">ECE: (Optional)</label>
              <input
                type="number"
                id="ece_marks"
                name="ece_marks"
                value="{{ enquiry.ece_marks | default('', true) }}"
                step="any"
              />
            </div>
          </div>
        </div>

        <div id="otherSubjectsSection">
          <div class="section-title">Kannada, English, Other Subjects (Optional)</div>
          <div class="row three-cols">
              <div class="form-group">
                  <label for="kannada_marks_12">Kannada/Telugu/Sanskrit: (Optional)</label>
                  <input
                      type="number"
                      id="kannada_marks_12"
                      name="kannada_marks_12"
                      value="{{ enquiry.kannada_marks_12 | default('', true) }}"
                      step="any"
                  />
              </div>
              <div class="form-group">
                  <label for="english_marks_12">English: (Optional)</label>
                  <input
                      type="number"
                      id="english_marks_12"
                      name="english_marks_12"
                      value="{{ enquiry.english_marks_12 | default('', true) }}"
                      step="any"
                  />
              </div>
              <div class="form-group">
                  <label for="other_unnamed_marks_12">Other Subject Marks: (Optional)</label>
                  <input
                      type="number"
                      id="other_unnamed_marks_12"
                      name="other_unnamed_marks_12"
                      value="{{ enquiry.other_unnamed_marks_12 | default('', true) }}"
                      step="any"
                  />
              </div>
          </div>
        </div>

        <div id="percentageDetailsSection">
          <div class="section-title">Percentage Details</div>
          <div class="row two-cols">
            <div class="form-group">
              <label for="total_percentage">Total Percentage:</label>
              <input
                type="number"
                id="total_percentage"
                name="total_percentage"
                value="{{ enquiry.total_percentage | default('', true) }}"
                step="any"
              />
            </div>
            <div class="form-group">
              <label for="pcm_percentage">PCM Percentage:</label>
              <input
                type="number"
                id="pcm_percentage"
                name="pcm_percentage"
                value="{{ enquiry.pcm_percentage | default('', true) }}"
                step="any"
              />
            </div>
          </div>
        </div>

        <div id="entranceExamSection">
          <div class="section-title">Entrance Exam Detail</div>
          <div class="row three-cols">
            <div class="form-group">
              <label for="jee_rank">JEE Rank:</label>
              <input
                type="text"
                id="jee_rank"
                name="jee_rank"
                value="{{ enquiry.jee_rank | default('', true) }}"
                step="1"
              />
            </div>
            <div class="form-group">
              <label for="comedk_rank">COMEDK Rank:</label>
              <input
                type="text"
                id="comedk_rank"
                name="comedk_rank"
                value="{{ enquiry.comedk_rank | default('', true) }}"
                step="1"
              />
            </div>
            <div class="form-group">
              <label for="cet_rank">CET Rank:</label>
              <input
                type="text"
                id="cet_rank"
                name="cet_rank"
                value="{{ enquiry.cet_rank | default('', true) }}"
                step="1"
              />
            </div>
          </div>
        </div>

        <div class="section-title">Course Preference Order</div>
        <div class="info-box">
          <i class="fas fa-info-circle"></i> Click on courses in order of your
          preference. The first course you select will be your first preference.
        </div>

        <div class="checkbox-group" style="margin-top: 20px">
          {% for course in all_courses %}
          <div
            class="{% if course in current_preferences %}selected-course-row{% endif %}"
            style="
              display: grid;
              grid-template-columns: 1fr 70px;
              gap: 8px;
              align-items: center;
              margin-bottom: 6px;
              border-radius: 6px;
              border: 1px solid #dbeafe;
              transition: background 0.2s;
            "
          >
            <div style="display: flex; align-items: center">
              {% if course in current_preferences %}
              <span
                style="
                   display: inline-flex;
                   align-items: center;
                   justify-content: center;
                   width: 32px;
                   height: 32px;
                   background: #007bff;
                   color: #fff;
                   font-weight: bold;
                   border-radius: 50%;
                   font-size: 1.08em;
                   margin-right: 14px;
                 "
                 >{{ current_preferences[course].preference_order }}</span
               >
               {% else %}
               <span
                 style="
                   display: inline-flex;
                   align-items: center;
                   justify-content: center;
                   width: 32px;
                   height: 32px;
                   background: #e0e7ff;
                   color: #b0b7c3;
                   font-weight: bold;
                   border-radius: 50%;
                   font-size: 1.08em;
                   margin-right: 14px;
                 "
                 >&ndash;</span
               >
               {% endif %}
               <input
                 type="checkbox"
                 name="course_preference"
                 value="{{ course }}"
                 id="course_{{ loop.index }}"
                 style="
                   margin-right: 12px;
                   transform: scale(1.2);;
                   accent-color: #007bff;
                 "
                 {% if course in current_preferences %}checked{% endif %}
                 class="print-hidden"
               />
               <label
                 for="course_{{ loop.index }}"
                 style="
                   flex: 1;
                   font-size: 1.08em;
                   font-weight: 500;
                   margin-bottom: 0;
                   cursor: pointer;
                   color: #222;
                 "
               >
                 {{ course }}
               </label>
             </div>
             {% if course in current_preferences %}
             <div
               style="
                 display: flex;
                 align-items: center;
                 justify-content: center;
               "
             >
               <input
                 type="number"
                 name="preference_order_{{ course|replace(' ', '_')|replace('(', '')|replace(')', '')|replace('.', '') }}"
                 min="1"
                 style="
                   width: 55px;
                   height: 36px;
                   font-size: 1.2em;
                   border: 2px solid #007bff;
                   border-radius: 7px;
                   text-align: center;
                   background: #f8fafc;
                   color: #007bff;
                   font-weight: bold;
                 "
                 value="{{ current_preferences[course].preference_order }}"
                 required
               />
             </div>
             {% else %}
             <div></div>
             {% endif %}
           </div>
           {% endfor %}
         </div>

         <div class="button-group">
           <button type="submit" class="print-hidden">Save Changes</button>
         </div>
       </form>

       {% endif %}
     </div>

     <script>
       const educationQualificationSelect = document.getElementById('education_qualification');
       const twelfthStandardSection = document.getElementById('section12thStandard');
       const entranceExamSection = document.getElementById('entranceExamSection');
       const optionalSubjectsSection = document.getElementById('optionalSubjectsSection');
       const otherSubjectsSection = document.getElementById('otherSubjectsSection');
       const percentageDetailsSection = document.getElementById('percentageDetailsSection');
       let diplomaSection = document.getElementById('diplomaSection');
       const section11th = document.getElementById('section11th');

       if (!diplomaSection) {
         const form = document.querySelector('form');
         const entranceExamSectionElement = document.getElementById('entranceExamSection');
         const newDiplomaSection = document.createElement('div');
         newDiplomaSection.id = 'diplomaSection';
         newDiplomaSection.innerHTML = `
           <h3 class="section-title">Diploma Details</h3>
           <div class="row two-cols">
             <div class="form-group">
               <label for="diploma_percentage">Diploma Percentage:</label>
               <input
                 type="number"
                 step="0.01"
                 id="diploma_percentage"
                 name="diploma_percentage"
                 value="{{ enquiry.diploma_percentage | default('', true) }}"
               />
             </div>
             <div class="form-group">
               <label for="dcet_rank">DCET Rank:</label>
               <input
                 type="text"
                 id="dcet_rank"
                 name="dcet_rank"
                 value="{{ enquiry.dcet_rank | default('', true) }}"
               />
             </div>
           </div>
         `;
         form.insertBefore(newDiplomaSection, entranceExamSectionElement.nextSibling);
         diplomaSection = newDiplomaSection;
       }

       // Function to toggle sections based on education qualification
       function toggleEducationSections() {
           const selectedQualification = educationQualificationSelect.value;

           // Get references to all relevant sections that should be toggled
           const section12thStandard = document.getElementById('section12thStandard');
           const educationBoard11thGroup = document.querySelector('.form-group label[for="education_board"]').closest('.form-group'); // Target the 11th board form group
           const section11th = document.getElementById('section11th');
           const optionalSubjectsSection = document.getElementById('optionalSubjectsSection');
           const otherSubjectsSection = document.getElementById('otherSubjectsSection');
           const percentageDetailsSection = document.getElementById('percentageDetailsSection');
           const entranceExamSection = document.getElementById('entranceExamSection');
           const diplomaSection = document.getElementById('diplomaSection');

           if (selectedQualification === '12th') {
               // Show 12th related sections
               if (section12thStandard) section12thStandard.style.display = '';
               if (educationBoard11thGroup) educationBoard11thGroup.style.display = ''; // Show 11th board
               // section11th visibility is handled by updateEleventhStandardVisibility
               if (optionalSubjectsSection) optionalSubjectsSection.style.display = '';
               if (otherSubjectsSection) otherSubjectsSection.style.display = '';
               if (percentageDetailsSection) percentageDetailsSection.style.display = '';
               if (entranceExamSection) entranceExamSection.style.display = '';

               // Hide diploma section
               if (diplomaSection) diplomaSection.style.display = 'none';
               // Re-evaluate 11th standard visibility based on board *after* showing the 12th related sections
               updateEleventhStandardVisibility(); // Call this to show/hide section11th based on 11th board value
           } else if (selectedQualification === 'Diploma') {
               // Hide all 12th related sections
               if (section12thStandard) section12thStandard.style.display = 'none';
               if (educationBoard11thGroup) educationBoard11thGroup.style.display = 'none'; // Hide 11th board
               if (section11th) section11th.style.display = 'none'; // Explicitly hide 11th section
               if (optionalSubjectsSection) optionalSubjectsSection.style.display = 'none';
               if (otherSubjectsSection) otherSubjectsSection.style.display = 'none';
               if (percentageDetailsSection) percentageDetailsSection.style.display = 'none';
               if (entranceExamSection) entranceExamSection.style.display = 'none';

               // Show diploma section
               if (diplomaSection) diplomaSection.style.display = '';
           } else {
               // Default or no selection - hide all specific sections
               if (section12thStandard) section12thStandard.style.display = 'none';
               if (educationBoard11thGroup) educationBoard11thGroup.style.display = 'none';
               if (section11th) section11th.style.display = 'none';
               if (diplomaSection) diplomaSection.style.display = 'none';
           }
       }

       // Add event listener to the education qualification dropdown
       educationQualificationSelect.addEventListener('change', toggleEducationSections);

       // Call toggleEducationSections and then hideEmptyFormGroups after the DOM is loaded
       document.addEventListener('DOMContentLoaded', () => {
           toggleEducationSections();
           hideEmptyFormGroups();
       });

       // Ensure the 11th standard visibility is updated whenever the board or education qualification changes
       const educationBoardSelect = document.getElementById('education_board');
       if (educationBoardSelect) {
           educationBoardSelect.addEventListener('change', updateEleventhStandardVisibility);
       }

       // Also call updateEleventhStandardVisibility initially if 12th is the pre-selected option
       // This handles cases where the page loads with '12th' already selected.
       const initialQualification = educationQualificationSelect.value;
       if (initialQualification === '12th') {
           updateEleventhStandardVisibility();
       }

       // Function to hide empty form groups
       function hideEmptyFormGroups() {
           const formGroups = document.querySelectorAll('form .form-group');
           formGroups.forEach(formGroup => {
               // Find the input, select, or textarea within the form group
               const input = formGroup.querySelector('input, select, textarea');
 
               if (input) {
                   let isEmpty = false;
                   // Check if the input value is empty
                   if (input.type === 'number') {
                       // For number inputs, check if value is null, undefined, or empty string
                       // Or if the value when converted to number is NaN
                       const numValue = parseFloat(input.value);
                       isEmpty = input.value === null || input.value === undefined || input.value.trim() === '' || isNaN(numValue);
                   } else if (input.tagName === 'SELECT') {
                       // For select elements, check if the selected option has an empty value
                       isEmpty = !input.value || input.value.trim() === '';
                   } else if (input.tagName === 'TEXTAREA') {
                        // For textareas, check if the trimmed value is empty
                       isEmpty = !input.value || input.value.trim() === '';
                   } else {
                       // For other input types (text, email, date, etc.), check if the trimmed value is empty
                       isEmpty = !input.value || input.value.trim() === '';
                   }
 
                   // If the input is empty, hide the form group
                   if (isEmpty) {
                       formGroup.style.display = 'none';
                   }
               }
           });
       }

       function updateOptionalSubjectsSection() {
         var board = document.getElementById('education_board').value;
         var optionalSubjectsSection = document.getElementById('optionalSubjectsSection');
         if (board === 'AP/Telangana') {
           optionalSubjectsSection.style.display = 'none';
         } else {
           optionalSubjectsSection.style.display = '';
         }
       }

       // Update on board change
       if (educationBoardSelect) {
         educationBoardSelect.addEventListener('change', updateOptionalSubjectsSection);
       }
       // Initial call
       updateOptionalSubjectsSection();

       function update12thPCMRowVisibility() {
         var board = document.getElementById('education_board').value;
         var row12thPCM = document.getElementById('row12thPCM');
         if (row12thPCM) {
           if (board === 'AP/Telangana') {
             row12thPCM.style.display = 'none';
           } else {
             row12thPCM.style.display = '';
           }
         }
       }
       if (educationBoardSelect) {
         educationBoardSelect.addEventListener('change', update12thPCMRowVisibility);
       }
       document.addEventListener('DOMContentLoaded', update12thPCMRowVisibility);

       function updateEleventhStandardVisibility() {
         var board = document.getElementById('education_board').value;
         var section11th = document.getElementById('section11th');
         if (section11th) {
           if (board === 'AP/Telangana') {
             section11th.style.display = 'block';
           } else {
             section11th.style.display = 'none';
           }
         }
       }
     </script>
   </body>
 </html>
